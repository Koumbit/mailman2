#!/usr/bin/make -f
# -*- makefile -*- made with the aid of debmake, by Christoph Lameter,
# based on the sample debian/rules file for GNU hello by Ian Jackson.
#
# $URL$
# $Id$

package=mailman-clamav
PACKAGE=$(package)

include /usr/share/dpatch/dpatch.make

binaries =
manpages = 
export DH_VERBOSE=1

SHELL=/bin/bash

ifneq (,$(findstring debug,$(DEB_BUILD_OPTIONS)))
CFLAGS += -g
endif
ifeq (,$(findstring nostrip,$(DEB_BUILD_OPTIONS)))
INSTALL_PROGRAM += -s
endif

build: patch-stamp Makefile debian/po/templates.pot
	$(MAKE) 
	touch build

debian/po/templates.pot: debian/templates
	@debconf-updatepo

Makefile:
	autoconf
	./configure --prefix=/var/lib/$(package) --with-username=list \
		--with-groupname=list \
		--with-mail-gid=daemon --with-cgi-gid=www-data \
		--without-permcheck --with-mailhost=localhost \
		--with-urlhost=localhost

clean: unpatch
	$(checkdir)
	-$(MAKE) distclean
	rm -rf build Makefile debian/ucffiles debian/mailman.postinst.ucf
	rm -f debian/mailman.postrm.ucf
	dh_clean
	rm -rf $$(find . -name "*~")
	find .. -name $(package)*dsc.asc -size 0 -maxdepth 1 -exec rm {} ";"
	chmod +x debian/{prerm,postinst}

binary-indep:	checkroot build
	$(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.


binary-arch:	checkroot build
	$(checkdir)

	dh_installdirs
	dh_installdocs ACKNOWLEDGMENTS README* TODO BUGS NEWS FAQ
	dh_installchangelogs

	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dpkg --build debian/mailman ..


define checkdir
	test -f debian/rules
endef

# Below here is fairly generic really

binary:		binary-indep binary-arch

checkroot:
	$(checkdir)
	dh_testroot

.PHONY: binary binary-arch binary-indep clean checkroot
